
# Copilot Instructions for AI Coding Agents

## Project Overview
This repository analyzes Ad vs PSA performance using the Kaggle `marketing_AB` dataset. It demonstrates a production-style workflow for experiment integrity, estimation, robustness, and decision reporting. The codebase is organized for reproducible analytics and clear separation of directional vs causal claims.

## Architecture & Key Components
- **decision_pack/**: Core pipeline for experiment integrity audit, estimation, and reporting.
  - `src/abpack/`: Python modules for data loading (`io.py`), integrity checks (`checks.py`), reporting (`reporting.py`, `run.py`, `run_estimation.py`), power analysis (`power.py`), robustness checks, and statistical analysis (`stats.py`).
  - `reports/`: Markdown outputs (integrity, estimation, decision memo, power planning).
  - `data/`: Place the Kaggle CSV here locally (not committed to git).
  - `tests/fixtures/`: Small sample for CI and smoke tests.
- **dbt_marketing_ab/**: dbt project for data modeling (staging → intermediate → marts). See `models/` for SQL transformation layers.
- **notebooks/**: Jupyter notebooks for EDA, diagnostics, estimation, and recommendations. Follow the numbered order for workflow.
- **src/ab_experiment/**: Standalone Python module for data access and stats utilities, used in both pipeline and notebooks.
- **visuals/**: Output figures for reports and notebooks.

## Developer Workflows
- **Run integrity and estimation pipeline:**
  ```powershell
  cd decision_pack/src
  python -m abpack.run
  python -m abpack.run_estimation
  ```
  Outputs are written to `decision_pack/reports/`.
- **Notebooks:** Use Jupyter for EDA, diagnostics, and reporting. See `notebooks/` for workflow order (start with `01_eda_and_randomization_checks.ipynb`).
- **dbt:** Build models in `dbt_marketing_ab/models/` for staged, intermediate, and mart tables. Use dbt CLI for builds.
- **Testing:** Use sample data in `decision_pack/tests/fixtures/` for CI and smoke tests. Test modules in `decision_pack/src/abpack/` using pytest.

## Project-Specific Patterns & Conventions
- **Directional vs Causal:** Integrity checks (SRM, timing, randomization) are required before interpreting lift as causal. Reports and code clearly distinguish between directional evidence and causal claims.
- **SRM & QA:** Always run SRM and timing diagnostics before estimation. See `decision_pack/src/abpack/checks.py` and `decision_pack/reports/integrity_report.md` for implementation and output.
- **Data location:** Large datasets are not committed; use local `decision_pack/data/marketing_ab.csv` for full runs, or `tests/fixtures/marketing_ab_sample.csv` for tests.
- **Reporting:** All key findings are written to markdown in `decision_pack/reports/` for stakeholder communication. Reports are generated by pipeline scripts.
- **Reproducibility:** All analysis steps are modularized for rerun and auditability. Avoid hardcoding paths; use relative paths and config where possible.
- **dbt conventions:** Models are organized by layer (staging, intermediate, marts). Use `sources.yml` and model-specific `.yml` files for documentation and testing.

## Integration Points
- **Python:** pandas, numpy, scipy for analysis. See `requirements.txt` and `decision_pack/requirements.txt` for dependencies.
- **dbt:** SQL models for data transformation. Use dbt CLI for builds and tests.
- **Jupyter:** Notebooks for interactive analysis and documentation. Notebooks use both pipeline and standalone modules.

## Examples
- To run a full integrity audit and estimation:
  ```powershell
  cd decision_pack/src
  python -m abpack.run
  python -m abpack.run_estimation
  ```
- To view results, check `decision_pack/reports/integrity_report.md` and `decision_pack/reports/estimation_report.md`.
- For EDA and diagnostics, open `notebooks/01_eda_and_randomization_checks.ipynb`.
- To run tests:
  ```powershell
  cd decision_pack
  pytest
  ```

## References
- See `README.md` for business context, workflow, and roadmap.
- See `decision_pack/docs/experiment_design_spec.md` for experiment design details.
- See `decision_pack/README_decision_pack.md` for pipeline usage and details.

---

If any section is unclear or missing, please provide feedback to improve these instructions for future AI agents.
